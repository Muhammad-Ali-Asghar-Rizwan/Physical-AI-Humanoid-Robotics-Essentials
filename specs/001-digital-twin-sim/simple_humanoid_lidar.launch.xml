<?xml version="1.0"?>
<launch>
  <!-- These are the arguments you can pass this launch file -->
  <arg name="world" default="humanoid_arena" 
       description="Choose one of the world files from `/simple_humanoid_gazebo/worlds`"/>

  <!-- Gazebo simulation -->
  <include file="$(find gazebo_ros)/launch/gazebo.launch.py">
    <arg name="world" value="$(find simple_humanoid_gazebo)/worlds/$(var world).sdf"/>
    <arg name="verbose" value="false"/>
  </include>

  <!-- Convert xacro to urdf with LiDAR -->
  <param name="robot_description" 
         command="xacro $(find simple_humanoid_description)/urdf/simple_humanoid_with_lidar.urdf"/>

  <!-- Spawn robot in gazebo -->
  <node pkg="gazebo_ros" type="spawn_entity.py" name="spawn_urdf"
        args="-entity simple_humanoid_with_sensors -topic robot_description -z 1.0"/>

  <!-- Robot state publisher -->
  <node pkg="robot_state_publisher" type="robot_state_publisher" 
        name="robot_state_publisher">
    <param name="publish_frequency" value="30.0"/>
    <param name="robot_description" value="$(param robot_description)"/>
  </node>

  <!-- Joint state publisher -->
  <node pkg="joint_state_publisher" type="joint_state_publisher" 
        name="joint_state_publisher">
    <param name="rate" value="30"/>
  </node>

  <!-- Load joint controller configurations from YAML file -->
  <rosparam file="$(find simple_humanoid_control)/config/simple_humanoid_controllers.yaml" 
           command="load"/>

  <!-- Load the controllers -->
  <node name="controller_manager" pkg="controller_manager" type="spawner" 
        args="simple_humanoid_joint_state_controller"/>
  <node name="controller_manager" pkg="controller_manager" type="spawner" 
        args="simple_humanoid_position_controller"/>

  <!-- RViz for visualization -->
  <node pkg="rviz2" type="rviz2" name="rviz2"
        args="-d $(find simple_humanoid_viz)/rviz/simple_humanoid_lidar.rviz"/>
</launch>